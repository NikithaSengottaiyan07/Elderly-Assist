{"version":3,"names":["Voice","Platform","ReactNativeVoiceSTTProvider","constructor","locale","_defineProperty","initialize","timeout","OS","onSpeechResults","event","_this$speechEndHandle","_this$speechResultsHa","cancel","stop","destroy","speechEndHandlers","forEach","handle","speechResultsHandlers","value","setTimeout","clearTimeout","_this$speechResultsHa2","onSpeechError","_this$speechErrorHand","speechErrorHandlers","_event$error","error","message","onSpeechPartialResults","_this$speechPartialHa","speechPartialHandlers","onSpeechStart","_this$speechStartHand","speechStartHandlers","onSpeechRecognized","_this$speechRecognize","speechRecognizedHandlers","isFinal","onSpeechEnd","_this$speechEndHandle2","onSpeechVolumeChanged","_this$speechVolumeHan","speechVolumeHandlers","startListening","start","stopListening","cancelListening","destroyInstance","removeAllListeners","isVoiceAvailable","isAvailable","isRecognizing","getSpeechRecognitionServices","services","addFinishListener","callback","_this$speechResultsHa3","push","addErrorListener","_this$speechErrorHand2","addPartialListener","_this$speechPartialHa2","addStartListener","_this$speechStartHand2","addRecognizedListener","_this$speechRecognize2","addEndListener","_this$speechEndHandle3","addVolumeListener","_this$speechVolumeHan2","clearHandlers"],"sources":["ReactNativeVoiceSTTProvider.ts"],"sourcesContent":["import Voice, { SpeechEndEvent, SpeechErrorEvent, SpeechRecognizedEvent, SpeechResultsEvent, SpeechStartEvent, SpeechVolumeChangeEvent } from '@react-native-voice/voice';\r\nimport type VoicifySpeechToTextProvider from './VoicifySpeechToTextProvider';\r\nimport { Platform } from 'react-native';\r\n\r\nexport class ReactNativeVoiceSTTProvider implements VoicifySpeechToTextProvider {\r\n    locale: string\r\n    speechResultsHandlers: ((fullResult: string) => void)[] = []\r\n    speechErrorHandlers: ((error: string) => void)[] = []\r\n    speechPartialHandlers: ((partialResult: string) => void)[] = []\r\n    speechStartHandlers: ((error?: boolean) => void)[] = []\r\n    speechRecognizedHandlers: ((isFinal: boolean) => void)[] = []\r\n    speechEndHandlers: ((error?: boolean) => void)[] = []\r\n    speechVolumeHandlers: ((value: number) => void)[] = []\r\n\r\n    constructor(locale: string) {\r\n        this.locale = locale;\r\n    }\r\n\r\n    initialize(locale: string) {\r\n        this.locale = locale;\r\n        let timeout: any\r\n        //The react native voice package has a bug on ios where it does not wait \r\n        //for the person to stop talking before firing the callback function\r\n        //this work around sets a timer and fires the handlers if no new words are deteced after 500 ms\r\n        if (Platform.OS == \"ios\") {\r\n            const onSpeechResults = (event: SpeechResultsEvent) => {\r\n                Voice.cancel()\r\n                Voice.stop()\r\n                Voice.destroy()\r\n                this.speechEndHandlers?.forEach(handle => handle(false));\r\n                this.speechResultsHandlers?.forEach(handle => event.value && handle(event.value[0]));\r\n            }\r\n            Voice.onSpeechResults = (event: SpeechResultsEvent) => {\r\n                if(!timeout)\r\n                {\r\n                    timeout = setTimeout(() => {\r\n                        onSpeechResults(event)\r\n                    }, 900)\r\n                }\r\n                else\r\n                {\r\n                    clearTimeout(timeout)\r\n                    timeout = setTimeout(() => {\r\n                        onSpeechResults(event)\r\n                    }, 900)\r\n                }\r\n            }\r\n        }\r\n        else if (Platform.OS == \"android\") {\r\n            Voice.onSpeechResults = (event: SpeechResultsEvent) => {\r\n                this.speechResultsHandlers?.forEach(handle => event.value && handle(event.value[0]))\r\n            }\r\n        }\r\n\r\n\r\n        Voice.onSpeechError = (event: SpeechErrorEvent) => {\r\n            this.speechErrorHandlers?.forEach(handle => event.error?.message && handle(event.error.message))\r\n        }\r\n        Voice.onSpeechPartialResults = (event: SpeechResultsEvent) => {\r\n            this.speechPartialHandlers?.forEach(handle => event.value && handle(event.value[0]))\r\n        }\r\n        Voice.onSpeechStart = (event?: SpeechStartEvent) => {\r\n            this.speechStartHandlers?.forEach(handle => handle(event?.error));\r\n        }\r\n        Voice.onSpeechRecognized = (event: SpeechRecognizedEvent) => {\r\n            this.speechRecognizedHandlers?.forEach(handle => event.isFinal && handle(event.isFinal));\r\n        }\r\n        Voice.onSpeechEnd = (event: SpeechEndEvent) => {\r\n            this.speechEndHandlers?.forEach(handle => handle(event?.error));\r\n        }\r\n        Voice.onSpeechVolumeChanged = (event: SpeechVolumeChangeEvent) => {\r\n            this.speechVolumeHandlers?.forEach(handle => event.value && handle(event.value));\r\n        }\r\n    }\r\n\r\n    startListening() {\r\n        Voice.start(this.locale)\r\n    }\r\n\r\n    stopListening() {\r\n        Voice.stop()\r\n    }\r\n\r\n    cancelListening() {\r\n        Voice.cancel()\r\n    }\r\n\r\n    destroyInstance() {\r\n        Voice.destroy()\r\n    }\r\n\r\n    removeAllListeners() {\r\n        Voice.removeAllListeners()\r\n    }\r\n\r\n    async isVoiceAvailable(): Promise<boolean> {\r\n        const isVoiceAvailable = await Voice.isAvailable();\r\n        if (isVoiceAvailable == 0) {\r\n            return (false)\r\n        }\r\n        else {\r\n            return (true)\r\n        }\r\n    }\r\n\r\n    async isRecognizing(): Promise<boolean> {\r\n        const isRecognizing = await Voice.isRecognizing();\r\n        if (isRecognizing == 0) {\r\n            return (false)\r\n        }\r\n        else {\r\n            return (true)\r\n        }\r\n    }\r\n\r\n    async getSpeechRecognitionServices(): Promise<string[]> {\r\n        const services = await Voice.getSpeechRecognitionServices();\r\n        if (services) {\r\n            return (services)\r\n        }\r\n        else {\r\n            return ([''])\r\n        }\r\n    }\r\n\r\n    addFinishListener(callback: (fullResult: string) => void) {\r\n        this.speechResultsHandlers?.push(callback);\r\n    }\r\n\r\n    addErrorListener(callback: (error: string) => void) {\r\n        this.speechErrorHandlers?.push(callback);\r\n    }\r\n\r\n    addPartialListener(callback: (partialResult: string) => void) {\r\n        this.speechPartialHandlers?.push(callback);\r\n    }\r\n\r\n    addStartListener(callback: (error?: boolean) => void) {\r\n        this.speechStartHandlers?.push(callback)\r\n    }\r\n\r\n    addRecognizedListener(callback: (isFinal: boolean) => void) {\r\n        this.speechRecognizedHandlers?.push(callback)\r\n    }\r\n\r\n    addEndListener(callback: (error?: boolean) => void) {\r\n        this.speechEndHandlers?.push(callback)\r\n    }\r\n\r\n    addVolumeListener(callback: (value: number) => void) {\r\n        this.speechVolumeHandlers?.push(callback)\r\n    }\r\n\r\n    clearHandlers() {\r\n        this.speechResultsHandlers = []\r\n        this.speechErrorHandlers = []\r\n        this.speechPartialHandlers = []\r\n        this.speechStartHandlers = []\r\n        this.speechEndHandlers = []\r\n        this.speechRecognizedHandlers = []\r\n        this.speechVolumeHandlers = []\r\n    }\r\n}"],"mappings":"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"}